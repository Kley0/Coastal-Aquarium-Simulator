<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marine Aquarium Simulator</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
      background: radial-gradient(circle at 50% 50%, #003d5c 0%, #001426 100%);
      color: #ffffff;
      height: 100%;
      overflow: hidden;
    }
    
    * {
      box-sizing: border-box;
    }
   .seagrass {
  position: absolute;
  bottom: 0;
  z-index: 2;
}

.seagrass-blade {
  position: absolute;
  bottom: 0;
  width: 8px;
  background: linear-gradient(to top, #2d5016 0%, #4a7c2c 50%, #6b9d4a 100%);
  border-radius: 4px 4px 0 0;
  transform-origin: bottom center;
  animation: seagrassSway 3s ease-in-out infinite;
}

.seagrass-blade:nth-child(1) {
  left: 0;
  height: 60px;
  animation-delay: 0s;
}

.seagrass-blade:nth-child(2) {
  left: 10px;
  height: 75px;
  animation-delay: 0.3s;
}

.seagrass-blade:nth-child(3) {
  left: 20px;
  height: 65px;
  animation-delay: 0.6s;
}

.seagrass-blade:nth-child(4) {
  left: 30px;
  height: 70px;
  animation-delay: 0.9s;
}

.seagrass-blade:nth-child(5) {
  left: 40px;
  height: 55px;
  animation-delay: 1.2s;
}

@keyframes seagrassSway {
  0%, 100% {
    transform: rotate(-8deg) scaleY(1);
  }
  25% {
    transform: rotate(5deg) scaleY(1.02);
  }
  50% {
    transform: rotate(8deg) scaleY(1);
  }
  75% {
    transform: rotate(-5deg) scaleY(0.98);
  }
}

    .game-wrapper {
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 20px;
      max-width: 1600px;
      margin: 0 auto;
    }

    .top-bar {
      background: rgba(0, 50, 80, 0.9);
      padding: 15px 25px;
      border-radius: 15px;
      margin-bottom: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(77, 208, 225, 0.3);
    }

    .game-title {
      margin: 0 0 12px 0;
      font-size: 26px;
      font-weight: bold;
      color: #4dd0e1;
      text-align: center;
      text-shadow: 0 0 10px rgba(77, 208, 225, 0.5);
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
    }

    .status-box {
      background: rgba(0, 30, 50, 0.7);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid rgba(100, 200, 255, 0.2);
    }

    .status-label {
      font-size: 11px;
      color: #80deea;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .status-number {
      font-size: 22px;
      font-weight: bold;
      color: #ffffff;
    }

    .main-game-area {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 15px;
      flex: 1;
      overflow: hidden;
    }

    .tank-section {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .aquarium-display {
      background: linear-gradient(to bottom, #004d7a 0%, #001a33 70%, #2d1810 100%);
      border-radius: 15px;
      border: 3px solid #1a4d7a;
      padding: 20px;
      position: relative;
      height: 400px;
      overflow: hidden;
      box-shadow: inset 0 0 50px rgba(0, 100, 150, 0.4), 0 8px 20px rgba(0, 0, 0, 0.4);
      @view-transition { navigation: auto; }
      <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
      <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
      <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
    }

    .tank-info {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 13px;
      z-index: 10;
    }

    .water-layer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom, transparent 0%, rgba(0, 100, 150, 0.1) 100%);
      animation: waterShimmer 4s ease-in-out infinite;
    }

    @keyframes waterShimmer {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    .dirt-particle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: rgba(139, 90, 43, 0.6);
      border-radius: 50%;
      z-index: 4;
      animation: float 8s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0) translateX(0);
      }
      25% {
        transform: translateY(-30px) translateX(10px);
      }
      50% {
        transform: translateY(-15px) translateX(-10px);
      }
      75% {
        transform: translateY(-40px) translateX(5px);
      }
    }

    .algae-spot {
      position: absolute;
      width: 20px;
      height: 20px;
      background: radial-gradient(circle, rgba(34, 139, 34, 0.4) 0%, transparent 70%);
      border-radius: 50%;
      z-index: 2;
    }

    .creature {
      position: absolute;
      font-size: 32px;
      transition: all 0.5s ease-out;
      cursor: pointer;
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
      z-index: 5;
      transform-origin: center;
    }

    .creature:hover {
      transform: scale(1.2) !important;
      filter: drop-shadow(0 6px 12px rgba(77, 208, 225, 0.6));
    }

    .creature.facing-left {
      transform: scaleX(-1);
    }

    .plant {
      position: absolute;
      bottom: 0;
      font-size: 28px;
      z-index: 3;
      animation: sway 3s ease-in-out infinite;
    }

    @keyframes sway {
      0%, 100% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
    }

    .rock {
      position: absolute;
      bottom: 10px;
      font-size: 24px;
      z-index: 2;
    }

    .particle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 50%;
      animation: rise 4s linear infinite;
      z-index: 4;
    }

    @keyframes rise {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0.8;
      }
      100% {
        transform: translateY(-400px) translateX(20px);
        opacity: 0;
      }
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      background: rgba(0, 50, 80, 0.9);
      padding: 15px;
      border-radius: 15px;
      border: 2px solid rgba(77, 208, 225, 0.3);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }

    .metric-card {
      background: rgba(0, 30, 50, 0.7);
      padding: 12px;
      border-radius: 10px;
      border: 2px solid rgba(100, 200, 255, 0.2);
    }

    .metric-title {
      font-size: 12px;
      color: #80deea;
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    .metric-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .metric-value {
      font-size: 20px;
      font-weight: bold;
    }

    .metric-bar-container {
      height: 12px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 6px;
      overflow: visible;
      border: 1px solid rgba(100, 200, 255, 0.3);
      position: relative;
    }

    .metric-bar {
      height: 100%;
      transition: width 0.4s ease, background-color 0.4s ease;
      border-radius: 6px;
    }

    .ideal-range-indicator {
      position: absolute;
      top: -2px;
      bottom: -2px;
      background: rgba(0, 230, 118, 0.3);
      border-left: 2px solid #00e676;
      border-right: 2px solid #00e676;
      pointer-events: none;
      z-index: 1;
    }

    .ideal-marker {
      position: absolute;
      top: -4px;
      bottom: -4px;
      width: 2px;
      background: #00e676;
      box-shadow: 0 0 4px #00e676;
      pointer-events: none;
      z-index: 2;
    }

    .bar-excellent { background: linear-gradient(90deg, #00e676, #00c853); }
    .bar-good { background: linear-gradient(90deg, #69f0ae, #00e676); }
    .bar-warning { background: linear-gradient(90deg, #ffd54f, #ffb300); }
    .bar-critical { background: linear-gradient(90deg, #ff6b6b, #d32f2f); }

    .control-panel {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .actions-container {
      background: rgba(0, 50, 80, 0.9);
      padding: 20px;
      border-radius: 15px;
      border: 2px solid rgba(77, 208, 225, 0.3);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }

    .actions-title {
      margin: 0 0 15px 0;
      font-size: 18px;
      color: #4dd0e1;
      text-align: center;
      font-weight: bold;
    }

    .action-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .action-button {
      background: linear-gradient(135deg, #0288d1 0%, #01579b 100%);
      color: white;
      border: none;
      padding: 15px 10px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
      transition: all 0.2s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    .action-button:hover:not(:disabled) {
      background: linear-gradient(135deg, #0277bd 0%, #004d7a 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    }

    .action-button:active:not(:disabled) {
      transform: translateY(0);
    }

    .action-button:disabled {
      background: linear-gradient(135deg, #424242 0%, #212121 100%);
      cursor: not-allowed;
      opacity: 0.5;
    }

    .action-icon {
      font-size: 24px;
    }

    .action-cost {
      font-size: 16px;
      color: #b3e5fc;
      font-weight: bold;
    }

    .day-advance-btn {
      background: linear-gradient(135deg, #00e676 0%, #00c853 100%);
      grid-column: 1 / -1;
      padding: 18px;
      font-size: 16px;
    }

    .day-advance-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #00c853 0%, #009624 100%);
    }

    .log-container {
      background: rgba(0, 50, 80, 0.9);
      padding: 15px;
      border-radius: 15px;
      border: 2px solid rgba(77, 208, 225, 0.3);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      flex: 1;
      overflow: hidden;
     scrollbar-width: none;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .log-title {
      margin: 0 0 12px 0;
      font-size: 16px;
      color: #4dd0e1;
      font-weight: bold;
    }

    .log-messages {
      flex: 1;
     max-height: 180px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      min-height: 0;
     scrollbar-width: none;
    }

    .log-messages::-webkit-scrollbar {
      width: 8px;
    }

    .log-messages::-webkit-scrollbar-track {
      background: rgba(0, 30, 50, 0.5);
      border-radius: 4px;
    }

    .log-messages::-webkit-scrollbar-thumb {
      background: rgba(77, 208, 225, 0.5);
      border-radius: 4px;
    }

    .log-messages::-webkit-scrollbar-thumb:hover {
      background: rgba(77, 208, 225, 0.7);
    }

    .log-message {
      padding: 12px 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      font-size: 15px;
      line-height: 1.6;
      border-left: 4px solid;
      animation: slideIn 0.3s ease-out;
      flex-shrink: 0;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .log-info {
      background: rgba(77, 208, 225, 0.15);
      border-color: #4dd0e1;
      color: #b3e5fc;
    }

    .log-success {
      background: rgba(0, 230, 118, 0.15);
      border-color: #00e676;
      color: #b9f6ca;
    }

    .log-warning {
      background: rgba(255, 193, 7, 0.15);
      border-color: #ffc107;
      color: #fff9c4;
    }

    .log-danger {
      background: rgba(244, 67, 54, 0.15);
      border-color: #f44336;
      color: #ffcdd2;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(135deg, #1a237e 0%, #0d1642 100%);
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
      border: 3px solid #1a4d7a;
      animation: scaleIn 0.3s ease-out;
    }

    @keyframes scaleIn {
      from {
        transform: scale(0.8);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .modal-content.victory {
      background: linear-gradient(135deg, #1b5e20 0%, #0d3312 100%);
      border-color: #2e7d32;
    }

    .modal-title {
      margin: 0 0 20px 0;
      font-size: 36px;
      color: #4dd0e1;
      font-weight: bold;
    }

    .modal-content.victory .modal-title {
      color: #69f0ae;
    }

    .modal-text {
      margin: 0 0 30px 0;
      font-size: 18px;
      line-height: 1.6;
      color: #b3e5fc;
    }

    .modal-button {
      background: linear-gradient(135deg, #0288d1 0%, #01579b 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
      transition: all 0.2s ease;
    }

    .modal-button:hover {
      background: linear-gradient(135deg, #0277bd 0%, #004d7a 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    }

    .modal-button:active {
      transform: translateY(0);
    }

    @media (max-width: 1024px) {
      .main-game-area {
        grid-template-columns: 1fr;
      }
      
      .action-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 768px) {
      .status-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .metrics-grid {
        grid-template-columns: 1fr;
      }
      
      .action-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
   <div class="seagrass" style="left: 5%;">
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
  </div>
  <div class="seagrass" style="left: 15%;">
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
  </div>
  <div class="seagrass" style="left: 28%;">
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
  </div>
  <div class="seagrass" style="left: 40%;">
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
  </div>
  <div class="seagrass" style="left: 52%;">
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
  </div>
  <div class="seagrass" style="left: 65%;">
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
  </div>
  <div class="seagrass" style="left: 78%;">
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
  </div>
  <div class="seagrass" style="left: 88%;">
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
   <div class="seagrass-blade"></div>
  </div>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a6611fc34a8f548',t:'MTc2NDQ2MDg4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
  <div class="game-wrapper">
   <div class="top-bar">
    <h1 class="game-title" id="game-title">üåä MARINE AQUARIUM SIMULATOR üåä</h1>
    <div class="status-grid">
     <div class="status-box">
      <div class="status-label">
       Day
      </div>
      <div class="status-number" id="day-display">
       1
      </div>
     </div>
     <div class="status-box">
      <div class="status-label">
       Budget
      </div>
      <div class="status-number" id="budget-display">
       $400
      </div>
     </div>
     <div class="status-box">
      <div class="status-label">
       Comfort
      </div>
      <div class="status-number" id="comfort-display">
       75
      </div>
     </div>
     <div class="status-box">
      <div class="status-label">
       Health
      </div>
      <div class="status-number" id="health-display">
       75
      </div>
     </div>
     <div class="status-box">
      <div class="status-label">
       Cleanliness
      </div>
      <div class="status-number" id="cleanliness-display">
       80
      </div>
     </div>
    </div>
   </div>
   <div class="main-game-area">
    <div class="tank-section">
     <div class="aquarium-display" id="aquarium">
      <div class="water-layer"></div>
     </div>
     <div class="metrics-grid">
      <div class="metric-card">
       <div class="metric-title">
        üíß Salinity
       </div>
       <div class="metric-display"><span class="metric-value" id="salinity-val">35.0</span> <span style="font-size: 11px; color: #80deea;">ppt</span>
       </div>
       <div class="metric-bar-container">
        <div class="metric-bar bar-good" id="salinity-bar" style="width: 75%"></div>
       </div>
      </div>
      <div class="metric-card">
       <div class="metric-title">
        üí® Oxygen
       </div>
       <div class="metric-display"><span class="metric-value" id="oxygen-val">7.0</span> <span style="font-size: 11px; color: #80deea;">mg/L</span>
       </div>
       <div class="metric-bar-container">
        <div class="metric-bar bar-good" id="oxygen-bar" style="width: 75%"></div>
       </div>
      </div>
      <div class="metric-card">
       <div class="metric-title">
        ‚ò†Ô∏è Ammonia
       </div>
       <div class="metric-display"><span class="metric-value" id="ammonia-val">0.1</span> <span style="font-size: 11px; color: #80deea;">ppm</span>
       </div>
       <div class="metric-bar-container">
        <div class="metric-bar bar-good" id="ammonia-bar" style="width: 90%"></div>
       </div>
      </div>
      <div class="metric-card">
       <div class="metric-title">
        üå°Ô∏è Temperature
       </div>
       <div class="metric-display"><span class="metric-value" id="temp-val">25</span> <span style="font-size: 11px; color: #80deea;">¬∞C</span>
       </div>
       <div class="metric-bar-container">
        <div class="metric-bar bar-good" id="temp-bar" style="width: 75%"></div>
       </div>
      </div>
      <div class="metric-card">
       <div class="metric-title">
        ‚öóÔ∏è pH Level
       </div>
       <div class="metric-display"><span class="metric-value" id="ph-val">8.2</span> <span style="font-size: 11px; color: #80deea;">pH</span>
       </div>
       <div class="metric-bar-container">
        <div class="metric-bar bar-good" id="ph-bar" style="width: 80%"></div>
       </div>
      </div>
      <div class="metric-card">
       <div class="metric-title">
        üîÑ Filter Status
       </div>
       <div class="metric-display"><span class="metric-value" id="filter-val">Clean</span>
       </div>
       <div class="metric-bar-container">
        <div class="metric-bar bar-excellent" id="filter-bar" style="width: 100%"></div>
       </div>
      </div>
     </div>
    </div>
    <div class="control-panel">
     <div class="actions-container">
      <h2 class="actions-title">‚öôÔ∏è ACTIONS</h2>
      <div class="action-grid"><button class="action-button" id="action-climate"> <span class="action-icon">üå°Ô∏è</span> <span>Adjust Climate</span> <span class="action-cost">$30</span> </button> <button class="action-button" id="action-feed"> <span class="action-icon">üêü</span> <span>Feed Animals</span> <span class="action-cost">$20</span> </button> <button class="action-button" id="action-clean"> <span class="action-icon">üßπ</span> <span>Clean Tank</span> <span class="action-cost">$25</span> </button> <button class="action-button" id="action-enrich"> <span class="action-icon">üå±</span> <span>Add Enrichment</span> <span class="action-cost">$40</span> </button> <button class="action-button" id="action-repair"> <span class="action-icon">üîß</span> <span>Repair Equipment</span> <span class="action-cost">$50</span> </button> <button class="action-button" id="action-filter"> <span class="action-icon">üíß</span> <span>Backwash Filter</span> <span class="action-cost">$35</span> </button> <button class="action-button day-advance-btn" id="action-end-day"> <span class="action-icon">‚è≠Ô∏è</span> <span>END DAY</span> </button>
      </div>
     </div>
     <div class="log-container">
      <h3 class="log-title">üìã Event Log</h3>
      <div class="log-messages" id="log-messages"></div>
     </div>
    </div>
   </div>
  </div>
  <div class="modal-overlay" id="game-over-modal">
   <div class="modal-content" id="modal-content">
    <h2 class="modal-title" id="modal-title">Game Over</h2>
    <p class="modal-text" id="modal-message">Your aquarium adventure has ended.</p><button class="modal-button" id="restart-button">Play Again</button>
   </div>
  </div>
  <script>
    const defaultConfig = {
      game_title: "üåä MARINE AQUARIUM SIMULATOR üåä",
      win_message: "Expert Aquarist! Your reef thrives!",
      lose_message: "The reef has collapsed..."
    };

    let config = { ...defaultConfig };

    // Game state using class-based approach
    class AquariumGame {
      constructor() {
        this.state = {
          day: 1,
          budget: 400,
          comfort: 75,
          health: 75,
          cleanliness: 80,
          salinity: 35.0,
          oxygen: 7.0,
          ammonia: 0.1,
          temperature: 25,
          ph: 8.2,
          filterCycles: 0,
          enrichmentActive: false,
          lowComfortDays: 0,
          isGameOver: false,
          isVictory: false
        };

        this.UPKEEP_COST = 15;
        this.IDEAL_RANGES = {
          salinity: { min: 33, max: 37, weight: 1.5 },
          oxygen: { min: 6.5, max: 8.0, weight: 2 },
          ammonia: { min: 0, max: 0.2, weight: 3 },
          temperature: { min: 24, max: 28, weight: 1 },
          ph: { min: 8.0, max: 8.4, weight: 1.5 }
        };

        this.creatures = [];
        this.particles = [];
      }

      init() {
        this.setupAquarium();
        this.setupEventListeners();
        this.updateDisplay();
        this.logMessage("üéÆ Welcome to Marine Aquarium Simulator! Survive 10 days with Comfort ‚â•70 and Health ‚â•70.", "info");
        this.logMessage("üîß Marine Rule #1: Filter needs backwash every 3 days or oxygen drops!", "info");
        this.logMessage("üí° Marine Rule #2: Overfeeding has 20% chance to spike ammonia!", "info");
        this.startAnimations();
      }

      setupAquarium() {
        const tank = document.getElementById('aquarium');
        
        // Add fish
        const fishTypes = ['üê†', 'üêü', 'üê°', 'ü¶à', 'üêô'];
        for (let i = 0; i < 5; i++) {
          const fish = document.createElement('div');
          fish.className = 'creature';
          fish.textContent = fishTypes[i % fishTypes.length];
          fish.dataset.index = i;
          
          const initialX = Math.random() * 80 + 10;
          const initialY = Math.random() * 250 + 50;
          
          fish.style.left = `${initialX}%`;
          fish.style.top = `${initialY}px`;
          
          fish.addEventListener('click', () => this.onCreatureClick(i));
          
          tank.appendChild(fish);
          
          this.creatures.push({
            element: fish,
            x: initialX,
            y: initialY,
            vx: (Math.random() - 0.5) * 2,
            vy: (Math.random() - 0.5) * 1
          });
        }

        // Add bubbles
        for (let i = 0; i < 8; i++) {
          setTimeout(() => this.createParticle(), i * 500);
        }

        // Dirt and algae will be added dynamically based on salinity
        this.updateTankCleanliness();
      }

      createParticle() {
        if (this.state.isGameOver) return;

        const tank = document.getElementById('aquarium');
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = `${Math.random() * 90 + 5}%`;
        particle.style.bottom = '0';
        particle.style.animationDuration = `${3 + Math.random() * 2}s`;
        tank.appendChild(particle);

        setTimeout(() => {
          if (particle.parentNode) {
            particle.parentNode.removeChild(particle);
          }
          this.createParticle();
        }, 4000);
      }

      updateTankCleanliness() {
        const tank = document.getElementById('aquarium');
        
        // Remove existing dirt and algae
        const existingDirt = tank.querySelectorAll('.dirt-particle, .algae-spot');
        existingDirt.forEach(el => el.remove());
        
        let totalDirtAmount = 0;
        let totalAlgaeAmount = 0;
        
        // Add dirt and algae based on salinity (clean at 35.0, dirty below)
        if (this.state.salinity < 35.0) {
          totalDirtAmount += Math.floor((35.0 - this.state.salinity) * 5);
          totalAlgaeAmount += Math.floor((35.0 - this.state.salinity) * 3);
        }
        
        // Add dirt and algae based on filter status (more cycles = dirtier)
        if (this.state.filterCycles > 0) {
          totalDirtAmount += this.state.filterCycles * 8;
          totalAlgaeAmount += this.state.filterCycles * 4;
        }
        
        // Add dirt particles
        for (let i = 0; i < Math.min(totalDirtAmount, 40); i++) {
          const dirt = document.createElement('div');
          dirt.className = 'dirt-particle';
          dirt.style.left = `${Math.random() * 90 + 5}%`;
          dirt.style.bottom = `${Math.random() * 30 + 5}%`;
          dirt.style.animationDelay = `${Math.random() * 8}s`;
          dirt.style.animationDuration = `${6 + Math.random() * 4}s`;
          tank.appendChild(dirt);
        }
        
        // Add algae spots
        for (let i = 0; i < Math.min(totalAlgaeAmount, 20); i++) {
          const algae = document.createElement('div');
          algae.className = 'algae-spot';
          algae.style.left = `${Math.random() * 95}%`;
          algae.style.top = `${Math.random() * 80 + 10}%`;
          algae.style.width = `${15 + Math.random() * 15}px`;
          algae.style.height = `${15 + Math.random() * 15}px`;
          tank.appendChild(algae);
        }
      }

      onCreatureClick(index) {
        this.logMessage(`üê† You interacted with creature #${index + 1}! It seems happy!`, "success");
        this.state.comfort = Math.min(100, this.state.comfort + 1);
        this.updateDisplay();
      }

      startAnimations() {
        const animate = () => {
          if (this.state.isGameOver) return;

          this.creatures.forEach(creature => {
            creature.x += creature.vx * 0.3;
            creature.y += creature.vy * 0.3;

            if (creature.x < 5 || creature.x > 90) creature.vx *= -1;
            if (creature.y < 30 || creature.y > 320) creature.vy *= -1;

            // Make fish face the direction they're moving
            if (creature.vx > 0) {
              creature.element.classList.add('facing-left');
            } else {
              creature.element.classList.remove('facing-left');
            }

            creature.element.style.left = `${creature.x}%`;
            creature.element.style.top = `${creature.y}px`;
          });

          requestAnimationFrame(animate);
        };
        animate();
      }

      setupEventListeners() {
        document.getElementById('action-climate').addEventListener('click', () => this.performAction('climate', 30));
        document.getElementById('action-feed').addEventListener('click', () => this.performAction('feed', 20));
        document.getElementById('action-clean').addEventListener('click', () => this.performAction('clean', 25));
        document.getElementById('action-enrich').addEventListener('click', () => this.performAction('enrich', 40));
        document.getElementById('action-repair').addEventListener('click', () => this.performAction('repair', 50));
        document.getElementById('action-filter').addEventListener('click', () => this.performAction('filter', 35));
        document.getElementById('action-end-day').addEventListener('click', () => this.endDay());
        document.getElementById('restart-button').addEventListener('click', () => this.restart());
      }

      performAction(actionType, cost) {
        if (this.state.budget < cost) {
          this.logMessage(`‚ùå Not enough budget! Need $${cost}.`, "danger");
          return;
        }

        this.state.budget -= cost;

        switch(actionType) {
          case 'climate':
            this.state.temperature = 25 + (Math.random() - 0.5) * 0.8;
            this.state.salinity = 35 + (Math.random() - 0.5) * 0.8;
            this.logMessage("üå°Ô∏è Climate adjusted to optimal levels!", "success");
            break;

          case 'feed':
            this.state.comfort += 3;
            if (Math.random() < 0.2) {
              this.state.ammonia += 0.3;
              this.logMessage("üêü Animals fed but overfeeding detected! Ammonia spiked!", "warning");
            } else {
              this.logMessage("üêü Animals fed successfully!", "success");
            }
            break;

          case 'clean':
            this.state.cleanliness = Math.min(100, this.state.cleanliness + 25);
            this.state.ammonia = Math.max(0, this.state.ammonia - 0.2);
            this.logMessage("üßπ Tank thoroughly cleaned! Ammonia reduced.", "success");
            break;

          case 'enrich':
            this.state.comfort += 5;
            this.state.enrichmentActive = true;
            this.logMessage("üå± Environmental enrichment added! Animals exploring happily!", "success");
            break;

          case 'repair':
            this.state.oxygen = 7.0;
            this.state.temperature = 25;
            this.logMessage("üîß Equipment repaired and recalibrated!", "success");
            break;

          case 'filter':
            this.state.filterCycles = 0;
            this.state.oxygen = Math.min(8.0, this.state.oxygen + 0.5);
            this.state.cleanliness = Math.min(100, this.state.cleanliness + 10);
            this.logMessage("üíß Filter backwashed! Water clarity improved.", "success");
            break;
        }

        this.updateDisplay();
      }

      endDay() {
        this.state.budget -= this.UPKEEP_COST;
        
        const comfortChange = this.calculateComfortChange();
        this.state.comfort = Math.max(0, Math.min(100, this.state.comfort + comfortChange));
        
        this.state.health += (this.state.comfort - 70) / 20;
        this.state.health = Math.max(0, Math.min(100, this.state.health));
        
        this.state.cleanliness = Math.max(0, this.state.cleanliness - 8);
        this.state.oxygen = Math.max(5, this.state.oxygen - 0.2);
        this.state.ammonia = Math.min(1, this.state.ammonia + 0.05);
        
        this.state.filterCycles++;
        if (this.state.filterCycles >= 3) {
          this.state.oxygen -= 0.5;
          this.logMessage("‚ö†Ô∏è Filter clogged! Oxygen decreased. Backwash needed!", "warning");
        }
        
        this.triggerRandomEvent();
        
        if (this.state.comfort < 40) {
          this.state.lowComfortDays++;
        } else {
          this.state.lowComfortDays = 0;
        }
        
        this.state.day++;
        this.state.enrichmentActive = false;
        
        this.logMessage(`üìÖ Day ${this.state.day - 1} ended. Daily upkeep: -$${this.UPKEEP_COST}`, "info");
        
        this.checkGameEnd();
        this.updateDisplay();
      }

      calculateComfortChange() {
        let change = 2;
        
        const metrics = {
          salinity: this.state.salinity,
          oxygen: this.state.oxygen,
          ammonia: this.state.ammonia,
          temperature: this.state.temperature,
          ph: this.state.ph
        };

        for (const [metric, value] of Object.entries(metrics)) {
          const range = this.IDEAL_RANGES[metric];
          if (value >= range.min && value <= range.max) {
            change += 1;
          } else {
            const distance = Math.min(
              Math.abs(value - range.min),
              Math.abs(value - range.max)
            );
            change -= distance * range.weight;
          }
        }
        
        if (this.state.cleanliness < 50) change -= 2;
        if (this.state.enrichmentActive) change += 1;
        
        return change;
      }

      triggerRandomEvent() {
        if (Math.random() > 0.6) return;

        const events = [
          {
            name: "Storm Surge",
            effect: () => {
              this.state.salinity += 1.5;
              this.state.cleanliness -= 12;
              this.logMessage("‚õàÔ∏è Storm surge affected water parameters!", "warning");
            }
          },
          {
            name: "Beneficial Bacteria",
            effect: () => {
              this.state.ammonia = Math.max(0, this.state.ammonia - 0.15);
              this.logMessage("ü¶† Beneficial bacteria colony thriving! Ammonia neutralized.", "success");
            }
          },
          {
            name: "Equipment Sponsorship",
            effect: () => {
              this.state.budget += 40;
              this.logMessage("üí∞ Equipment sponsorship received! +$40", "success");
            }
          },
          {
            name: "Algae Outbreak",
            effect: () => {
              this.state.oxygen -= 1.0;
              this.state.cleanliness -= 18;
              this.state.ph -= 0.25;
              this.logMessage("ü¶† Algae outbreak! Multiple parameters affected!", "danger");
            }
          },
          {
            name: "Temperature Fluctuation",
            effect: () => {
              this.state.temperature += (Math.random() > 0.5 ? 2.5 : -2.5);
              this.state.comfort -= 5;
              this.logMessage("üå°Ô∏è Unexpected temperature swing!", "warning");
            }
          },
          {
            name: "Perfect Conditions",
            effect: () => {
              this.state.comfort += 8;
              this.state.health += 3;
              this.logMessage("‚ú® Perfect aquarium conditions! Animals thriving!", "success");
            }
          },
          {
            name: "pH Shock",
            effect: () => {
              this.state.ph += (Math.random() > 0.5 ? 0.4 : -0.4);
              this.state.comfort -= 4;
              this.logMessage("‚öóÔ∏è pH shock detected! Monitor carefully.", "warning");
            }
          },
          {
            name: "Oxygen Enrichment",
            effect: () => {
              this.state.oxygen = Math.min(8.0, this.state.oxygen + 0.8);
              this.logMessage("üí® Natural oxygen enrichment occurred!", "success");
            }
          }
        ];

        const event = events[Math.floor(Math.random() * events.length)];
        event.effect();
      }

      checkGameEnd() {
        // Check if any metric bar is in critical (red) state
        const range = this.IDEAL_RANGES;
        
        // Check salinity - critical if too far from ideal range
        if (this.state.salinity < range.salinity.min || this.state.salinity > range.salinity.max) {
          const distance = Math.min(
            Math.abs(this.state.salinity - range.salinity.min),
            Math.abs(this.state.salinity - range.salinity.max)
          );
          if (distance > 1.5) {
            this.endGame(false, "CRITICAL: Salinity reached dangerous levels! Marine life perished!");
            return;
          }
        }
        
        // Check oxygen - critical if too far from ideal range
        if (this.state.oxygen < range.oxygen.min || this.state.oxygen > range.oxygen.max) {
          const distance = Math.min(
            Math.abs(this.state.oxygen - range.oxygen.min),
            Math.abs(this.state.oxygen - range.oxygen.max)
          );
          if (distance > 1.5) {
            this.endGame(false, "CRITICAL: Oxygen levels reached lethal levels! Marine life suffocated!");
            return;
          }
        }
        
        // Check ammonia - critical if above 0.5 (when bar turns red)
        if (this.state.ammonia > 0.5) {
          this.endGame(false, "CRITICAL: Ammonia poisoning! All animals died!");
          return;
        }
        
        // Check temperature - critical if too far from ideal range
        if (this.state.temperature < range.temperature.min || this.state.temperature > range.temperature.max) {
          const distance = Math.min(
            Math.abs(this.state.temperature - range.temperature.min),
            Math.abs(this.state.temperature - range.temperature.max)
          );
          if (distance > 1.5) {
            this.endGame(false, "CRITICAL: Temperature reached lethal levels! All animals died!");
            return;
          }
        }
        
        // Check pH - critical if too far from ideal range
        if (this.state.ph < range.ph.min || this.state.ph > range.ph.max) {
          const distance = Math.min(
            Math.abs(this.state.ph - range.ph.min),
            Math.abs(this.state.ph - range.ph.max)
          );
          if (distance > 1.5) {
            this.endGame(false, "CRITICAL: pH reached toxic levels! Marine ecosystem collapsed!");
            return;
          }
        }
        
        // Check if filter is completely clogged (bar turns red at 0%)
        if (this.state.filterCycles >= 3) {
          this.endGame(false, "CRITICAL: Filter completely failed! System shutdown!");
          return;
        }
        
        if (this.state.comfort <= 0 || this.state.health <= 0 || this.state.cleanliness <= 0) {
          this.endGame(false, "Critical metrics dropped to zero!");
          return;
        }
        
        if (this.state.lowComfortDays >= 3) {
          this.endGame(false, "Animal comfort remained too low for 3 consecutive days!");
          return;
        }
        
        if (this.state.budget < 0) {
          this.endGame(false, "Budget depleted completely!");
          return;
        }
        
        if (this.state.day > 10 && this.state.comfort >= 70 && this.state.health >= 70) {
          this.endGame(true, "Successfully maintained the aquarium for 10 days!");
          return;
        }
      }

      endGame(isVictory, reason) {
        this.state.isGameOver = true;
        this.state.isVictory = isVictory;

        const modal = document.getElementById('game-over-modal');
        const content = document.getElementById('modal-content');
        const title = document.getElementById('modal-title');
        const message = document.getElementById('modal-message');

        title.textContent = isVictory ? "üèÜ VICTORY! üèÜ" : "üíÄ GAME OVER üíÄ";
        
        const baseMessage = isVictory 
          ? config.win_message || defaultConfig.win_message
          : config.lose_message || defaultConfig.lose_message;
        
        message.textContent = `${baseMessage} ${reason}`;
        
        content.className = isVictory ? "modal-content victory" : "modal-content";
        modal.classList.add('active');
      }

      restart() {
        location.reload();
      }

      updateDisplay() {
        document.getElementById('day-display').textContent = this.state.day;
        document.getElementById('budget-display').textContent = `$${this.state.budget}`;
        document.getElementById('comfort-display').textContent = Math.round(this.state.comfort);
        document.getElementById('health-display').textContent = Math.round(this.state.health);
        document.getElementById('cleanliness-display').textContent = Math.round(this.state.cleanliness);

        this.updateMetric('salinity', this.state.salinity, 30, 40, 33, 37);
        this.updateMetric('oxygen', this.state.oxygen, 5, 10, 6.5, 8.0);
        this.updateMetric('ammonia', this.state.ammonia, 0, 1, 0, 0.2);
        this.updateMetric('temp', this.state.temperature, 20, 30, 24, 28);
        this.updateMetric('ph', this.state.ph, 7.5, 8.8, 8.0, 8.4);
        
        this.updateTankCleanliness();

        const filterStatus = this.state.filterCycles === 0 ? 'Clean' : 
                           this.state.filterCycles === 1 ? 'Good' :
                           this.state.filterCycles === 2 ? 'Needs Wash' : 'Clogged!';
        document.getElementById('filter-val').textContent = filterStatus;
        
        const filterBar = document.getElementById('filter-bar');
        const filterPercent = Math.max(0, 100 - (this.state.filterCycles * 33));
        filterBar.style.width = `${filterPercent}%`;
        filterBar.className = `metric-bar ${filterPercent > 66 ? 'bar-excellent' : filterPercent > 33 ? 'bar-warning' : 'bar-critical'}`;

        this.updateButtons();
      }

      updateMetric(name, value, min, max, idealMin, idealMax) {
        document.getElementById(`${name}-val`).textContent = value.toFixed(1);
        
        const percentage = ((value - min) / (max - min)) * 100;
        const bar = document.getElementById(`${name}-bar`);
        bar.style.width = `${Math.max(0, Math.min(100, percentage))}%`;

        // Add ideal range indicator
        const container = bar.parentElement;
        let indicator = container.querySelector('.ideal-range-indicator');
        if (!indicator) {
          indicator = document.createElement('div');
          indicator.className = 'ideal-range-indicator';
          container.appendChild(indicator);
        }
        
        const idealMinPercent = ((idealMin - min) / (max - min)) * 100;
        const idealMaxPercent = ((idealMax - min) / (max - min)) * 100;
        indicator.style.left = `${idealMinPercent}%`;
        indicator.style.width = `${idealMaxPercent - idealMinPercent}%`;

        let barClass = 'bar-excellent';
        
        if (name === 'ammonia') {
          if (value > 0.5) barClass = 'bar-critical';
          else if (value > 0.3) barClass = 'bar-warning';
          else if (value > 0.2) barClass = 'bar-good';
        } else {
          const range = this.IDEAL_RANGES[name] || { min: 0, max: 100 };
          if (value < range.min || value > range.max) {
            const distance = Math.min(Math.abs(value - range.min), Math.abs(value - range.max));
            barClass = distance > 1.5 ? 'bar-critical' : distance > 0.8 ? 'bar-warning' : 'bar-good';
          } else {
            barClass = 'bar-excellent';
          }
        }
        
        bar.className = `metric-bar ${barClass}`;
      }

      updateButtons() {
        const costs = {
          'action-climate': 30,
          'action-feed': 20,
          'action-clean': 25,
          'action-enrich': 40,
          'action-repair': 50,
          'action-filter': 35
        };

        for (const [id, cost] of Object.entries(costs)) {
          document.getElementById(id).disabled = this.state.budget < cost;
        }
      }

      logMessage(text, type = 'info') {
        const logContainer = document.getElementById('log-messages');
        const messageEl = document.createElement('div');
        messageEl.className = `log-message log-${type}`;
        messageEl.textContent = text;
        
        logContainer.appendChild(messageEl);
        
        if (logContainer.children.length > 30) {
          logContainer.removeChild(logContainer.firstChild);
        }
        
        // Auto-scroll to bottom (newest message)
        logContainer.scrollTop = logContainer.scrollHeight;
      }
    }

    // Initialize game
    const game = new AquariumGame();
    
    async function onConfigChange(newConfig) {
      config = { ...config, ...newConfig };
      
      const titleElement = document.getElementById("game-title");
      if (titleElement) {
        titleElement.textContent = config.game_title || defaultConfig.game_title;
      }
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["win_message", config.win_message || defaultConfig.win_message],
          ["lose_message", config.lose_message || defaultConfig.lose_message]
        ])
      });

      window.elementSdk.setConfig(defaultConfig);
    }

    // Start the game
    game.init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a5a32ab11d50651',t:'MTc2NDMzNjM5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
